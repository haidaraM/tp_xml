<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="iso-8859-1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> Partie Ajax par Yoam Hazot et Mohamed HAIDARA - B3446 </title>

    <!-- Bootstrap -->
    <link href="fichiersPourAjax/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
        .instruction {
            font-style: italic;
            color: #006600;
        }

        .thumbnail-size {
            width: 96px;
            padding-right: 10px
        }

        .media-list li {
            padding: 5px
        }
    </style>
    <!-- Partie javascrit -->
    <script type="text/javascript">
        //check if the first node is an element node
        function recupererPremierElementEnfant(n) {
            x = n.firstChild;
            while ( x.nodeType != 1 ) { // Test if x is an element node (and not a text node or other)
                x = x.nextSibling;
            }

            return x;
        }

        var click = false;
        // Modifie la couleur de l'arrière plan et la couleur du bouton
        function setBackgroundAndBoutonColor(){
            // récupération du body de la page
            var background = window.document.getElementById("body");
            background.style.backgroundColor ="#489AFF"

            // récuperation du bouton
            var bouton = window.document.getElementById("bouton1");
            bouton.style.color="white"
        }

        // Charge le fichier JSON se trouvant à l'URL donnée en paramètre et le retourne
        function getHttpJSON(jsonDocumentUrl) {

            var httpAjax;

            httpAjax = window.XMLHttpRequest ?
                    new XMLHttpRequest() :
                    new ActiveXObject('Microsoft.XMLHTTP');

            if (httpAjax.overrideMimeType) {
                httpAjax.overrideMimeType('text/xml');
            }

            // chargement du fichier JSON à l'aide de XMLHttpRequest synchrone (le 3° paramètre est défini à false)
            httpAjax.open('GET', jsonDocumentUrl, false);
            httpAjax.send();

            var responseData = eval("(" + httpAjax.responseText + ")");

            return responseData;
        }

        //charge le fichier XML se trouvant à l'URL relative donné dans le paramètre et le retourne
        function getHttpXML(xmlDocumentUrl) {

            var httpAjax;

            httpAjax = window.XMLHttpRequest ?
                    new XMLHttpRequest() :
                    new ActiveXObject('Microsoft.XMLHTTP');

            if (httpAjax.overrideMimeType) {
                httpAjax.overrideMimeType('text/xml');
            }

            //chargement du fichier XML à l'aide de XMLHttpRequest synchrone (le 3° paramètre est défini à false)
            httpAjax.open('GET', xmlDocumentUrl, false);
            httpAjax.send();

            return httpAjax.responseXML;
        }

        // affiche les informations des évènements dont le titre contient le mot "Workaholics"
        function infoWorkaholics(){

            // creation du bouton
            var bouton = document.createElement("button");
            // creation du texte du bouton
            var text = document.createTextNode("Bouton 3 (fn : MajInfoWorkaholics)");

            // attributs du bouton : fonction à declencher et css
            bouton.setAttribute("onclick","MajInfoWorkaholics()");
            bouton.setAttribute("class","btn btn-default");

            bouton.appendChild(text);
            var li = document.createElement("li");
            li.appendChild(bouton);


            var xsltProcessor = new XSLTProcessor();

            // Chargement du fichier XSL
            var xslDocument = getHttpXML('fichiersPourAjax/calendar-eventlist-workaholics.xsl');

            // Importation du .xsl
            xsltProcessor.importStylesheet(xslDocument);

            // Chargement du fichier XML
            var xmlDocument = getHttpXML('fichiersPourAjax/calendar-short.xml');

            // Création du document XML transformé par le XSL
            var newXmlDocuement = xsltProcessor.transformToDocument(xmlDocument);
            // recuperation du noeud dans le nouveau document
            var elementAInserer = newXmlDocuement.getElementsByTagName("ul")[0];

            // pour éviter plusieurs boutons et informations concernant la série
            if(click == false){
                click = true;
                // affichage du bouton
                document.getElementById("liste_bouton").appendChild(li);
                // ajout du noeud recupéré dans le document transformé
                document.getElementById("aCompleter").appendChild(elementAInserer);
            }
        }

        function MajInfoWorkaholics(urlJSOn){
            // on recupere le noeud li
            var liListe = document.getElementById("aCompleter").getElementsByClassName("media")[0];

            // creation du lien et mise en place des attributs
            var lien = document.createElement("a");
            lien.setAttribute("class","pull-left thumbnail-size");
            lien.setAttribute("href","http://www.google.fr");

            var image = document.createElement("img");
            image.setAttribute("class","media-object img-thumbnail responsive");
            image.setAttribute("src","http://ia.media-imdb.com/images/M/MV5BMTU3MDE2Mjg0NF5BMl5BanBnXkFtZTgwMzYyMzc1MDE@._V1_SX300.jpg");

            // ajout de l'image au lien
            lien.appendChild(image);

            // insertion du lien avant le media-body
            liListe.insertBefore(lien,liListe.childNodes[0]);

        }

    </script>
</head>

<body id="body">
<div class="container">
    <h1> Partie Ajax par Yoam HAZOT et Mohamed HAIDARA - B3446 </h1>

    <h2>Travail réalisé</h2>

    <p>
    <ol id="liste_bouton">
        <li>
            <input id="bouton1" class="btn btn-default" value="Bouton 1 (fn :setBackgroundAndBoutonColor) " type="button" onclick="setBackgroundAndBoutonColor()">
        </li> <br/>
        <li>
            <input id="bouton2" class="btn btn-default" value="Bouton 2 (fn: infoWorkaholics)" type="button" onclick="infoWorkaholics()">
        </li> <br/>
    </ol>

    <div id="aCompleter"> </div>

    </p>
</div>
</body>
</html>