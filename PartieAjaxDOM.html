<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="iso-8859-1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> Partie Ajax par Yoam Hazot et Mohamed HAIDARA - B3446 </title>

    <!-- Bootstrap -->
    <link href="fichiersPourAjax/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
        .instruction {
            font-style: italic;
            color: #006600;
        }

        .thumbnail-size {
            width: 96px;
            padding-right: 10px
        }

        .media-list li {
            padding: 5px
        }
    </style>
    <!-- Partie javascrit -->
    <script type="text/javascript">

        // variable pour checher si un bouton a été cliqué
        var clickBouton2 = false;
        var clickBouton3 = false;
        var clickBouton4 = false;

        //check if the first node is an element node
        function recupererPremierElementEnfant(n) {
            x = n.firstChild;
            while ( x.nodeType != 1 ) { // Test if x is an element node (and not a text node or other)
                x = x.nextSibling;
            }
            return x;
        }

        // transforme un document xml à travers une feuille de style xsl
        function xmlTransformByXsl(xmlDocumentUrl, xslDocumentUrl){
            var xsltProcessor = new XSLTProcessor();

            // Chargement du fichier XSL
            var xslDocument = getHttpXML(xslDocumentUrl);

            // Importation du .xsl
            xsltProcessor.importStylesheet(xslDocument);

            // Chargement du fichier XML
            var xmlDocument = getHttpXML(xmlDocumentUrl);

            // Création du document XML transformé par le XSL
            var newXmlDocuement = xsltProcessor.transformToDocument(xmlDocument);

            return newXmlDocuement;
        }

        // Modifie la couleur de l'arrière plan et la couleur du bouton
        function setBackgroundAndBoutonColor(){
            // récupération du body de la page
            var background = window.document.getElementById("body");
            background.style.backgroundColor ="#489AFF"

            // récuperation du bouton
            var bouton = window.document.getElementById("bouton1");
            bouton.style.color="white"
        }

        // Charge le fichier JSON se trouvant à l'URL donnée en paramètre et le retourne
        function getHttpJSON(jsonDocumentUrl) {

            var httpAjax;

            httpAjax = window.XMLHttpRequest ?
                    new XMLHttpRequest() :
                    new ActiveXObject('Microsoft.XMLHTTP');

            if (httpAjax.overrideMimeType) {
                httpAjax.overrideMimeType('text/xml');
            }

            // chargement du fichier JSON à l'aide de XMLHttpRequest synchrone (le 3° paramètre est défini à false)
            httpAjax.open('GET', jsonDocumentUrl, false);
            httpAjax.send();

            var responseData = eval("(" + httpAjax.responseText + ")");

            return responseData;
        }

        //charge le fichier XML se trouvant à l'URL relative donné dans le paramètre et le retourne
        function getHttpXML(xmlDocumentUrl) {

            var httpAjax;

            httpAjax = window.XMLHttpRequest ?
                    new XMLHttpRequest() :
                    new ActiveXObject('Microsoft.XMLHTTP');

            if (httpAjax.overrideMimeType) {
                httpAjax.overrideMimeType('text/xml');
            }

            //chargement du fichier XML à l'aide de XMLHttpRequest synchrone (le 3° paramètre est défini à false)
            httpAjax.open('GET', xmlDocumentUrl, false);
            httpAjax.send();

            return httpAjax.responseXML;
        }

        // affiche les informations des évènements dont le titre contient le mot "Workaholics"
        function infoWorkaholics(xmlDocumentUrl,xslDocumentUrl,urlJson){

            // creation du bouton
            var bouton = document.createElement("button");
            // creation du texte du bouton
            var text = document.createTextNode("Bouton 3 (fn : MajInfoWorkaholics)");

            // attributs du bouton : fonction à declencher et css
            var parameters = "MajInfoWorkaholics(\"" + urlJson +"\")";
            bouton.setAttribute("onclick",parameters);
            bouton.setAttribute("class","btn btn-default");

            bouton.appendChild(text);
            var li = document.createElement("li");
            li.appendChild(bouton);

            // Création du document XML transformé par le XSL
            var newXmlDocument = xmlTransformByXsl(xmlDocumentUrl,xslDocumentUrl);

            // recuperation du noeud dans le nouveau document
            var elementAInserer = newXmlDocument.getElementsByTagName("ul")[0];

            // pour éviter plusieurs boutons et informations concernant la série
            if(clickBouton2 == false){
                clickBouton2 = true;

                // ajout d'un saut de ligne avant le bouton
                document.getElementById("liste_bouton").insertBefore(document.createElement("br"),document.getElementById("aCompleterBouton2"));

                // affichage du bouton
                document.getElementById("liste_bouton").insertBefore(li,document.getElementById("aCompleterBouton2"));

                // ajout du noeud recupéré dans le document transformé
                document.getElementById("aCompleterBouton2").appendChild(elementAInserer);
            }
        }

        // recupere les informations à partir de l'API omdb
        function MajInfoWorkaholics(urlJSOn){

            // Chargement du fichier JSON
            var response = getHttpJSON(urlJSOn);

            // on recupere le noeud li
            var liListe = document.getElementById("aCompleterBouton2").getElementsByClassName("media")[0];

            // creation du lien et mise en place des attributs
            var lien = document.createElement("a");
            lien.setAttribute("class","pull-left thumbnail-size");
            lien.setAttribute("href",response.Poster);

            // creation de l'image et mise en place des attributs
            var image = document.createElement("img");
            image.setAttribute("class","media-object img-thumbnail responsive");
            image.setAttribute("src",response.Poster);


            // insertion du lien avant le media-body
            liListe.insertBefore(lien,liListe.childNodes[0]);

            // Création de l'élément <div> correspondant aux caractéritiques du programme
            var moreInfos = document.createElement("div");

            // creation des labels
            var yearLabel = document.createElement("span");
            yearLabel.setAttribute("class", "label label-default");
            yearLabel.innerHTML = response.Year;
            var ratedLabel = document.createElement("span");
            ratedLabel.setAttribute("class", "label label-default");
            ratedLabel.innerHTML = response.Rated;
            var releasedLabel = document.createElement("span");
            releasedLabel.setAttribute("class", "label label-default");
            releasedLabel.innerHTML = response.Released;
            var runtimeLabel = document.createElement("span");
            runtimeLabel.setAttribute("class", "label label-default");
            runtimeLabel.innerHTML = response.Runtime;
            var genreLabel = document.createElement("span");
            genreLabel.setAttribute("class", "label label-default");
            genreLabel.innerHTML = response.Genre;
            var languageLabel = document.createElement("span");
            languageLabel.setAttribute("class", "label label-default");
            languageLabel.innerHTML = response.Language;
            var countryLabel = document.createElement("span");
            countryLabel.setAttribute("class", "label label-default");
            countryLabel.innerHTML = response.Country;
            var imdbRatingLabel = document.createElement("span");
            imdbRatingLabel.setAttribute("class", "label label-default");
            imdbRatingLabel.innerHTML = response.imdbRating;
            var imdbVotesLabel = document.createElement("span");
            imdbVotesLabel.setAttribute("class", "label label-default");
            imdbVotesLabel.innerHTML = response.imdbVotes;

            //ajout des labels
            moreInfos.appendChild(yearLabel);
            moreInfos.appendChild(document.createTextNode (" "));
            moreInfos.appendChild(ratedLabel);
            moreInfos.appendChild(document.createTextNode (" "));
            moreInfos.appendChild(releasedLabel);
            moreInfos.appendChild(document.createTextNode (" "));
            moreInfos.appendChild(runtimeLabel);
            moreInfos.appendChild(document.createTextNode (" "));
            moreInfos.appendChild(genreLabel);
            moreInfos.appendChild(document.createTextNode (" "));
            moreInfos.appendChild(languageLabel);
            moreInfos.appendChild(document.createTextNode (" "));
            moreInfos.appendChild(countryLabel);
            moreInfos.appendChild(document.createTextNode (" "));
            moreInfos.appendChild(imdbRatingLabel);
            moreInfos.appendChild(document.createTextNode (" "));
            moreInfos.appendChild(imdbVotesLabel);

            if(clickBouton3 == false){
                clickBouton3 = true;
                // ajout de l'image au lien
                lien.appendChild(image);
                // ajout dans le noeud
                liListe.getElementsByClassName("media-body")[0].appendChild(moreInfos);
            }

        }

        //affiche le calendrier complet en utilisant une feuille de style
        function afficheCalendrier(xmlDocumentUrl,xslDocumentUrl,urlJson){
            // creation du bouton
            var bouton = document.createElement("button");
            // creation du texte du bouton
            var text = document.createTextNode("Bouton 5 (fn : MajAfficheCalendrier)");

            // attributs du bouton : fonction à declencher et css
            var parameters = "MajAfficheCalendrier(\"" + urlJson +"\")";
            bouton.setAttribute("onclick",parameters);
            bouton.setAttribute("class","btn btn-default");
            bouton.appendChild(text);
            var li = document.createElement("li");
            li.appendChild(bouton);

            // creation et récuperation du nouveau document transformé
            var xmlDocumentTransformed = xmlTransformByXsl(xmlDocumentUrl, xslDocumentUrl);
            // récuperation de la liste des elements
            var listeElementsAInserer = xmlDocumentTransformed.getElementsByTagName("ul");

            if(clickBouton4 == false)
            {
                // affichage du bouton
                document.getElementById("liste_bouton").insertBefore(li,document.getElementById("aCompleterBouton4"));
                clickBouton4 = true;
                // parcours et affichage de la liste des éléments
                for(i=0; i<listeElementsAInserer.length;i++){
                    // ajout du noeud recupéré dans le document transformé
                    document.getElementById("aCompleterBouton4").appendChild(listeElementsAInserer[i]);
                }
                //petit saut de ligne
                document.getElementById("aCompleterBouton4").appendChild(document.createElement("br"));

            }
        }

        // met à jour le calendrier complet en ajoutant des images et autres infos
        function MajAfficheCalendrier(urlJson){

        }

    </script>
</head>

<body id="body">
<div class="container">
    <h1> Partie Ajax par Yoam HAZOT et Mohamed HAIDARA - B3446 </h1>

    <h2>Travail réalisé</h2>

    <p>
    <ul id="liste_bouton">
        <li>
            <input id="bouton1" class="btn btn-default" value="Bouton 1 (fn :setBackgroundAndBoutonColor) " type="button" onclick="setBackgroundAndBoutonColor()"/>
        </li> <br/>
        <li>
            <input id="bouton2" class="btn btn-default" value="Bouton 2 (fn: infoWorkaholics)" type="button" onclick="infoWorkaholics('fichiersPourAjax/calendar-short.xml','fichiersPourAjax/calendar-eventlist-workaholics.xsl','http://www.omdbapi.com/?t=workaholics&y=&plot=short&r=json')"/>
        </li>
    <div id="aCompleterBouton2"> </div> <br/>
        <li>
            <input id="bouton4" class="btn btn-default" value="Bouton 4 (fn :afficheCalendrier) " type="button" onclick="afficheCalendrier('fichiersPourAjax/calendar-short.xml','fichiersPourAjax/calendar-eventlist.xsl')"/>
        </li><br/>
    <div id="aCompleterBouton4"> </div>
    </ul>

    </p>
</div>
</body>
</html>